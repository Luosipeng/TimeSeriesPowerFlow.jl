<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>TimeDomainPowerFlow · HyDistFlow.jl</title><meta name="title" content="TimeDomainPowerFlow · HyDistFlow.jl"/><meta property="og:title" content="TimeDomainPowerFlow · HyDistFlow.jl"/><meta property="twitter:title" content="TimeDomainPowerFlow · HyDistFlow.jl"/><meta name="description" content="Documentation for HyDistFlow.jl."/><meta property="og:description" content="Documentation for HyDistFlow.jl."/><meta property="twitter:description" content="Documentation for HyDistFlow.jl."/><meta property="og:url" content="https://Luosipeng.github.io/HyDistFlow.jl/modules\\timedomainpowerflow.html"/><meta property="twitter:url" content="https://Luosipeng.github.io/HyDistFlow.jl/modules\\timedomainpowerflow.html"/><link rel="canonical" href="https://Luosipeng.github.io/HyDistFlow.jl/modules\\timedomainpowerflow.html"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Module</span><ul><li><a class="tocitem" href="overview.html">Overview</a></li><li><a class="tocitem" href="componentmodel.html">ComponentModel</a></li><li><a class="tocitem" href="utils.html">Utils</a></li><li><a class="tocitem" href="powerflow.html">PowerFlow</a></li><li class="is-active"><a class="tocitem" href="timedomainpowerflow.html">TimeDomainPowerFlow</a><ul class="internal"><li><a class="tocitem" href="#Module-Overview"><span>Module Overview</span></a></li><li><a class="tocitem" href="#Flow-Chart"><span>Flow Chart</span></a></li><li><a class="tocitem" href="#Time-Series-Data-Processing"><span>Time Series Data Processing</span></a></li><li><a class="tocitem" href="#Simulation-Functions"><span>Simulation Functions</span></a></li><li><a class="tocitem" href="#Visualization-Functions"><span>Visualization Functions</span></a></li><li><a class="tocitem" href="#Utility-Functions"><span>Utility Functions</span></a></li><li><a class="tocitem" href="#Testing"><span>Testing</span></a></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../api/componentmodel.html">ComponentModel API</a></li><li><a class="tocitem" href="../api/utils.html">Utils API</a></li><li><a class="tocitem" href="../api/powerflow.html">PowerFlow API</a></li><li><a class="tocitem" href="../api/timedomainpowerflow.html">TimeDomainPowerFlow API</a></li><li><a class="tocitem" href="../api/hydistflow.html">HyDistFlow API</a></li></ul></li><li><a class="tocitem" href="../references.html">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Module</a></li><li class="is-active"><a href="timedomainpowerflow.html">TimeDomainPowerFlow</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="timedomainpowerflow.html">TimeDomainPowerFlow</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Luosipeng/HyDistFlow.jl.git" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="github.com/Luosipeng/HyDistFlow.jl/blob/master/docs/src/modules/timedomainpowerflow.md#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="TimeDomainPowerFlow-Module"><a class="docs-heading-anchor" href="#TimeDomainPowerFlow-Module">TimeDomainPowerFlow Module</a><a id="TimeDomainPowerFlow-Module-1"></a><a class="docs-heading-anchor-permalink" href="#TimeDomainPowerFlow-Module" title="Permalink"></a></h1><p>The TimeDomainPowerFlow module provides tools and functions for time-series power flow analysis in power systems, including dynamic dispatch, voltage profile analysis, and renewable integration.</p><h2 id="Module-Overview"><a class="docs-heading-anchor" href="#Module-Overview">Module Overview</a><a id="Module-Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Module-Overview" title="Permalink"></a></h2><pre><code class="language-julia hljs">module TimeDomainPowerFlow

    using Printf
    using SparseArrays
    using Plots
    using Statistics
    using DataFrames
    using XLSX
    using Dates

    # Module exports and includes
    # ...
end</code></pre><h2 id="Flow-Chart"><a class="docs-heading-anchor" href="#Flow-Chart">Flow Chart</a><a id="Flow-Chart-1"></a><a class="docs-heading-anchor-permalink" href="#Flow-Chart" title="Permalink"></a></h2><p><img src="../assets/TimeDomainPowerFlow.png" alt="TimeDomainPowerFlow flow chart"/></p><h2 id="Time-Series-Data-Processing"><a class="docs-heading-anchor" href="#Time-Series-Data-Processing">Time Series Data Processing</a><a id="Time-Series-Data-Processing-1"></a><a class="docs-heading-anchor-permalink" href="#Time-Series-Data-Processing" title="Permalink"></a></h2><h3 id="Reading-Load-Data"><a class="docs-heading-anchor" href="#Reading-Load-Data">Reading Load Data</a><a id="Reading-Load-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-Load-Data" title="Permalink"></a></h3><pre><code class="language-julia hljs">read_load_data(file_path)</code></pre><p>Read load time series data from an Excel file.</p><p><strong>Arguments</strong>:</p><ul><li><code>file_path</code>: Path to the Excel file containing load data</li></ul><p><strong>Returns</strong>:</p><ul><li><code>time_column</code>: Vector containing time values from the first column</li><li><code>time_str_column</code>: Vector containing time string representations from the second column</li><li><code>load_names</code>: Vector of load names extracted from column headers</li><li><code>data</code>: DataFrame containing the entire load dataset</li></ul><p>This function reads load time series data from an Excel file into a DataFrame. It extracts the time values, time string representations, and the names of the loads from the column headers.</p><h2 id="Simulation-Functions"><a class="docs-heading-anchor" href="#Simulation-Functions">Simulation Functions</a><a id="Simulation-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation-Functions" title="Permalink"></a></h2><h3 id="Run-Single-Day-Simulation"><a class="docs-heading-anchor" href="#Run-Single-Day-Simulation">Run Single Day Simulation</a><a id="Run-Single-Day-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Run-Single-Day-Simulation" title="Permalink"></a></h3><pre><code class="language-julia hljs">run_single_day(old_jpc, opt, day_load_matrix, day_price_line, day_irradiance_line)</code></pre><p>Run a day-ahead simulation for a hybrid AC-DC power system with renewable generation and energy storage.</p><p><strong>Arguments</strong>:</p><ul><li><code>old_jpc</code>: Original power system data structure</li><li><code>opt</code>: Power flow options</li><li><code>day_load_matrix</code>: Matrix containing hourly load data (hour, bus<em>id, active</em>power, reactive_power)</li><li><code>day_price_line</code>: Vector containing hourly electricity prices</li><li><code>day_irradiance_line</code>: Matrix containing hourly solar irradiance data</li></ul><p><strong>Returns</strong>:</p><ul><li>Simulation results including bus voltages, branch flows, and economic data</li></ul><h3 id="Run-Dynamic-Dispatch"><a class="docs-heading-anchor" href="#Run-Dynamic-Dispatch">Run Dynamic Dispatch</a><a id="Run-Dynamic-Dispatch-1"></a><a class="docs-heading-anchor-permalink" href="#Run-Dynamic-Dispatch" title="Permalink"></a></h3><pre><code class="language-julia hljs">run_dynamic_dispatch(new_jpc, Cld_ac, Cld_dc, loadAC_PD, loadAC_QD, loadDC_PD, genAC_PG,
                    Cgen_ac, Cconv_ac, Cconv_dc, η_rec, η_inv, Cpv_ac, Cpv_dc,
                    pv_ac_p_mw_ratio, pv_ac_p_mw, pv_max_p_mw, pv_max_p_mw_ratio,
                    Cstorage_ac, ess_initial_soc, ess_max_soc, ess_min_soc,
                    ess_charge_efficiency, ess_discharge_efficiency, ess_p_mw,
                    ess_e_mwh, ess_max_p_mw, ess_min_p_mw, time_step_h, time_periods,
                    price_line, irradiance_line, opt)</code></pre><p>Performs dynamic dispatch optimization for a hybrid AC-DC power system with renewable generation and energy storage.</p><p><strong>Arguments</strong>:</p><ul><li>Power system parameters (jpc, loads, generators)</li><li>Converter parameters (efficiency, costs)</li><li>PV parameters (capacity, ratios)</li><li>Storage parameters (SOC limits, efficiency, capacity)</li><li>Time parameters and price/irradiance data</li><li>Power flow options</li></ul><p><strong>Returns</strong>:</p><ul><li>Optimized dispatch results and power flow solutions</li></ul><h2 id="Visualization-Functions"><a class="docs-heading-anchor" href="#Visualization-Functions">Visualization Functions</a><a id="Visualization-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization-Functions" title="Permalink"></a></h2><h3 id="Plot-Voltage-Time-Series"><a class="docs-heading-anchor" href="#Plot-Voltage-Time-Series">Plot Voltage Time Series</a><a id="Plot-Voltage-Time-Series-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-Voltage-Time-Series" title="Permalink"></a></h3><pre><code class="language-julia hljs">plot_voltage_time_series(results, bus_name, case, time_day, bus_type = &quot;AC&quot;; 
                         save_path = nothing, save_format = &quot;pdf&quot;)</code></pre><p>Plot voltage time series for a specified bus in a power system.</p><p><strong>Arguments</strong>:</p><ul><li><code>results</code>: Simulation results containing bus voltage data</li><li><code>bus_name</code>: Name of the bus to plot voltage for</li><li><code>case</code>: Power system case data</li><li><code>time_day</code>: Number of days in the simulation</li><li><code>bus_type</code>: Type of bus to analyze (&quot;AC&quot; or &quot;DC&quot;)</li><li><code>save_path</code>: Optional path to save the plot</li><li><code>save_format</code>: Format to save the plot</li></ul><h3 id="Plot-Power-Flow-Violations"><a class="docs-heading-anchor" href="#Plot-Power-Flow-Violations">Plot Power Flow Violations</a><a id="Plot-Power-Flow-Violations-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-Power-Flow-Violations" title="Permalink"></a></h3><pre><code class="language-julia hljs">plot_flow_violations(results, case, time_day, flow_limit = 3.0, plot_type = &quot;summary&quot;, 
                    flow_direction = &quot;max&quot;; save_path = nothing, save_format = &quot;pdf&quot;)</code></pre><p>Plot power flow violations in power system branches.</p><p><strong>Arguments</strong>:</p><ul><li><code>results</code>: Simulation results containing branch flow data</li><li><code>case</code>: Power system case data</li><li><code>time_day</code>: Number of days in the simulation</li><li><code>flow_limit</code>: Power flow limit in MW (default: 3.0)</li><li><code>plot_type</code>: Type of plot to generate:<ul><li>&quot;summary&quot;: Overall statistics of violations</li><li>&quot;worst&quot;: Shows the worst branches with violations</li><li>&quot;all&quot;: Shows all branches with violations</li></ul></li><li><code>flow_direction</code>: How to evaluate flow violations:<ul><li>&quot;max&quot;: Maximum absolute value of flow in either direction</li><li>&quot;both&quot;: Same as &quot;max&quot;</li><li>&quot;forward&quot;: Only check flow from from-bus to to-bus</li><li>&quot;reverse&quot;: Only check flow from to-bus to from-bus</li></ul></li><li><code>save_path</code>: Optional path to save the plot</li><li><code>save_format</code>: Format to save the plot</li></ul><h3 id="Plot-Losses-Time-Series"><a class="docs-heading-anchor" href="#Plot-Losses-Time-Series">Plot Losses Time Series</a><a id="Plot-Losses-Time-Series-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-Losses-Time-Series" title="Permalink"></a></h3><pre><code class="language-julia hljs">plot_losses_time_series(results, case, time_day, plot_type = &quot;total&quot;, loss_type = &quot;active&quot;; 
                        save_path = nothing, save_format = &quot;pdf&quot;)</code></pre><p>Plot power system losses time series for AC and DC branches.</p><p><strong>Arguments</strong>:</p><ul><li><code>results</code>: Simulation results containing branch flow data</li><li><code>case</code>: Power system case data</li><li><code>time_day</code>: Number of days in the simulation</li><li><code>plot_type</code>: Type of plot to generate:<ul><li>&quot;total&quot;: Overall system losses</li><li>&quot;branch&quot;: Individual branch losses for major branches</li></ul></li><li><code>loss_type</code>: Type of losses to display:<ul><li>&quot;active&quot;: Only active power losses (MW)</li></ul></li><li><code>save_path</code>: Optional path to save the plot</li><li><code>save_format</code>: Format to save the plot</li></ul><h3 id="Plot-Active-Load-Time-Series"><a class="docs-heading-anchor" href="#Plot-Active-Load-Time-Series">Plot Active Load Time Series</a><a id="Plot-Active-Load-Time-Series-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-Active-Load-Time-Series" title="Permalink"></a></h3><pre><code class="language-julia hljs">plot_PD_time_series(results, bus_name, case, time_day; 
                   save_path = nothing, save_format = &quot;pdf&quot;)</code></pre><p>Plot the time series of active load.</p><p><strong>Arguments</strong>:</p><ul><li><code>results</code>: Result dataset</li><li><code>bus_name</code>: Bus name</li><li><code>case</code>: Power system case data</li><li><code>time_day</code>: Number of days in the simulation</li><li><code>save_path</code>: Optional path to save the plot</li><li><code>save_format</code>: Format to save the plot</li></ul><h3 id="Record-Voltage-Violations"><a class="docs-heading-anchor" href="#Record-Voltage-Violations">Record Voltage Violations</a><a id="Record-Voltage-Violations-1"></a><a class="docs-heading-anchor-permalink" href="#Record-Voltage-Violations" title="Permalink"></a></h3><pre><code class="language-julia hljs">record_voltage_violation(results, bus_name, case, time_day, bus_type = &quot;AC&quot;; 
                        save_path = nothing, save_format = &quot;pdf&quot;)</code></pre><p>Analyze and visualize voltage violations for a specified bus in a power system.</p><p><strong>Arguments</strong>:</p><ul><li><code>results</code>: Simulation results containing bus voltage data</li><li><code>bus_name</code>: Name of the bus to analyze voltage violations for</li><li><code>case</code>: Power system case data</li><li><code>time_day</code>: Number of days in the simulation</li><li><code>bus_type</code>: Type of bus to analyze:<ul><li>&quot;AC&quot;: AC bus</li><li>&quot;DC&quot;: DC bus</li></ul></li><li><code>save_path</code>: Optional path to save the plot</li><li><code>save_format</code>: Format to save the plot</li></ul><h2 id="Utility-Functions"><a class="docs-heading-anchor" href="#Utility-Functions">Utility Functions</a><a id="Utility-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Utility-Functions" title="Permalink"></a></h2><h3 id="Renumber-Hybrid-System"><a class="docs-heading-anchor" href="#Renumber-Hybrid-System">Renumber Hybrid System</a><a id="Renumber-Hybrid-System-1"></a><a class="docs-heading-anchor-permalink" href="#Renumber-Hybrid-System" title="Permalink"></a></h3><pre><code class="language-julia hljs">renumber_hybrid_system(jpc)</code></pre><p>Renumber buses and branches in a hybrid AC-DC power system to create a more organized numbering scheme.</p><p><strong>Arguments</strong>:</p><ul><li><code>jpc</code>: A structure containing the hybrid power system data with fields:<ul><li><code>busAC</code>: Matrix of AC bus data</li><li><code>busDC</code>: Matrix of DC bus data</li><li><code>branchAC</code>: Matrix of AC branch data</li><li><code>branchDC</code>: Matrix of DC branch data</li><li><code>convAC</code>: Matrix of AC converter data</li><li><code>convDC</code>: Matrix of DC converter data</li></ul></li></ul><p><strong>Returns</strong>:</p><ul><li>Updated <code>jpc</code> with renumbered components</li></ul><h2 id="Testing"><a class="docs-heading-anchor" href="#Testing">Testing</a><a id="Testing-1"></a><a class="docs-heading-anchor-permalink" href="#Testing" title="Permalink"></a></h2><p>The module includes a test script (<code>test_time_domain_pf.jl</code>) that demonstrates the use of the TimeDomainPowerFlow module for analyzing a power system over a time period. The script:</p><ol><li>Loads required packages</li><li>Reads power system data</li><li>Configures simulation parameters</li><li>Runs time-domain power flow analysis</li><li>Generates visualization of results</li></ol><pre><code class="language-julia hljs">using Dates
using XLSX
using DataFrames
using Base.Filesystem
using HyDistFlow.TimeDomainPowerFlowlow

# Input Data
file_path = joinpath(pwd(), &quot;data&quot;, &quot;test_case.xlsx&quot;)
load_path = joinpath(pwd(), &quot;data&quot;, &quot;load.xlsx&quot;)  
price_path = joinpath(pwd(), &quot;data&quot;, &quot;price.xlsx&quot;)  
irradiance_path = joinpath(pwd(), &quot;data&quot;, &quot;irradiance.xlsx&quot;)  

# Process Data
case = load_julia_power_data(file_path)
time_column, time_str_column, load_names, data = read_load_data(load_path) 
time_column, time_str_column, price_profiles = read_price_data(price_path)  
time_column, time_str_column, irradiance_profiles = read_irradiance_data(irradiance_path) 

# Topology processing
results, new_case = topology_analysis(case, output_file=&quot;topology_results.xlsx&quot;)

# Clear existing storage data and add a new battery storage system
empty!(new_case.storageetap)
push!(new_case.storages, Storage(1, &quot;Battery_ESS_1&quot;, 3, 0.75, 1.5, 0.3, 0.05, 0.95, 0.9, true, &quot;lithium_ion&quot;, true))

# Set control mode for converters to Droop_Udc_Us (voltage droop control)
new_case.converters[3].control_mode = &quot;Droop_Udc_Us&quot;
new_case.converters[2].control_mode = &quot;Droop_Udc_Us&quot;
new_case.converters[1].control_mode = &quot;Droop_Udc_Us&quot;

opt = options() # The initial settings 
opt[&quot;PF&quot;][&quot;NR_ALG&quot;] = &quot;bicgstab&quot;;
opt[&quot;PF&quot;][&quot;ENFORCE_Q_LIMS&quot;] = 0;
opt[&quot;PF&quot;][&quot;DC_PREPROCESS&quot;] = 1;

# Run time-series power flow calculation and measure execution time
@time results = runtdpf(new_case, data, load_names, price_profiles, irradiance_profiles, opt)

# # Get voltage results for all nodes
plot_result = plot_voltage_time_series(results, &quot;Bus_21&quot;, new_case, 366, &quot;AC&quot;; save_path=&quot;voltage_plot&quot;)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="powerflow.html">« PowerFlow</a><a class="docs-footer-nextpage" href="../api/componentmodel.html">ComponentModel API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Thursday 2 October 2025 20:22">Thursday 2 October 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
